import{d as T,e as _,g as f,m as y,_ as U,o as d,c as r,a as t,f as $,F as b,h as w,n as V,t as m,i as u,v as p,j as E,k as I,l as M,r as k,b as C}from"./index-4c7f9ad4.js";const{VITE_API_URL:D,VITE_API_PATH:R}={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"frank-hex-api",BASE_URL:"/live-vue3-training-homework-week7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},g=T("adminProductStore",{state:()=>({products:[],selectedProduct:{category:"",content:"",description:"",id:"",imageUrl:"",imagesUrl:[],is_enabled:0,origin_price:0,price:0,title:"",unit:"單位",num:0,rating:0},pagination:{total_pages:1,current_page:1},isNew:!0}),getters:{},actions:{async getProducts(e=1){try{const{data:s}=await _.get(`${D}/api/${R}/admin/products?page=${e}`,{headers:{Authorization:`${f()}`}});this.products=s.products,this.pagination=s.pagination}catch(s){alert(s.response.data.message)}},selectProduct(e){this.selectedProduct=e},clearProduct(){this.selectedProduct={category:"",content:"",description:"",id:"",imageUrl:"",imagesUrl:[],is_enabled:0,origin_price:0,price:0,title:"",unit:"單位",num:0,rating:0}},setIsNew(e){this.isNew=e}}}),N={name:"PaginationComponent",props:{},methods:{async pageChange(e){(e!==this.pagination.current_page||e>=0||e<=this.pagination.total_pages)&&await g().getProducts(e)}},computed:{...y(g,["pagination"])}},L={"aria-label":"Page navigation"},S={class:"pagination justify-content-center"},B={class:"page-item"},F=t("span",{"aria-hidden":"true"},"«",-1),H=[F],z=["onClick"],O={class:"page-item"},j=t("span",{"aria-hidden":"true"},"»",-1),X=[j];function q(e,s,l,c,h,a){return d(),r("nav",L,[t("ul",S,[t("li",B,[t("a",{class:"page-link",href:"#",onClick:s[0]||(s[0]=$(o=>a.pageChange(e.pagination.current_page-1),["prevent"]))},H)]),(d(!0),r(b,null,w(e.pagination.total_pages,o=>(d(),r("li",{class:V(["page-item",{active:e.pagination.current_page===o}]),key:o},[t("a",{class:"page-link",href:"#",onClick:$(i=>a.pageChange(o),["prevent"])},m(o),9,z)],2))),128)),t("li",O,[t("a",{class:"page-link",href:"#",onClick:s[1]||(s[1]=$(o=>a.pageChange(e.pagination.current_page+1),["prevent"]))},X)])])])}const G=U(N,[["render",q]]),{VITE_API_URL:P,VITE_API_PATH:v}={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"frank-hex-api",BASE_URL:"/live-vue3-training-homework-week7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},J={name:"UpdateProductModal",data(){return{modal:{}}},methods:{async updateProduct(e){const s=this.$loading.show();if(this.selectedProduct.origin_price=Number(this.selectedProduct.origin_price),this.selectedProduct.price=Number(this.selectedProduct.price),e)try{const{data:l}=await _.post(`${P}/api/${v}/admin/product`,{data:this.selectedProduct},{headers:{Authorization:`${f()}`}});l.success&&await g().getProducts(),this.$swal({title:"產品新增成功",icon:"success"})}catch{this.$swal({title:"產品新增失敗",icon:"success"})}else{try{const{data:l}=await _.put(`${P}/api/${v}/admin/product/${this.selectedProduct.id}`,{data:this.selectedProduct},{headers:{Authorization:`${f()}`}});l.success&&await g().getProducts(),this.$swal({title:"產品新增成功",icon:"success"})}catch{this.$swal({title:"產品新增失敗",icon:"success"})}s.hide()}},async uploadMainImage(e){if(e.target.files.length===0)return;const s=this.$loading.show(),l=e.target.files[0],c=new FormData;c.append("file-to-upload",l);try{const{data:h}=await _.post(`${P}/${v}/admin/upload`,c,{headers:{"Content-Type":"multipart/form-data",Authorization:`${f()}`}});this.selectedProduct.imageUrl=h.imageUrl,this.$swal({title:"圖片上傳成功",icon:"success"})}catch{this.$swal({title:"圖片上傳失敗，請重新上傳",icon:"success"})}finally{s.hide()}},clearMainImageFile(){this.$refs["image-file"].value=""},addImage(){var e;(e=this.selectedProduct)!=null&&e.imagesUrl||(this.selectedProduct.imagesUrl=[]),this.selectedProduct.imagesUrl.push("")},removeImagesUrl(e){this.selectedProduct.imagesUrl.splice(e,1)},async uploadImageFile(){const e=document.createElement("input");e.type="file",e.addEventListener("change",async s=>{const l=this.$loading.show(),c=s.target.files[0],h=new FormData;h.append("file-to-upload",c);try{const{data:a}=await _.post(`${P}/api/${v}/admin/upload`,h,{headers:{"Content-Type":"multipart/form-data",Authorization:`${f()}`}}),o=this.selectedProduct.imagesUrl;o[o.length-1]===""?o[o.length-1]=a.imageUrl:o.push(a.imageUrl),alert("圖片上傳成功")}catch{alert("圖片上傳失敗，請重新上傳")}finally{l.hide()}}),e.click()}},computed:{...y(g,["selectedProduct","isNew"])}},K={class:"modal fade",id:"updateProductModal",tabindex:"-1","aria-labelledby":"updateProductModalLabel","aria-hidden":"true"},Q={class:"modal-dialog modal-xl"},W={class:"modal-content"},Y={class:"modal-header"},Z={class:"modal-title fs-5",id:"updateProductModalLabel"},x=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),tt={class:"modal-body"},et={class:"row"},st={class:"col"},ot={class:"mb-3"},at=t("label",{for:"title",class:"form-label"},"標題",-1),lt={class:"mb-3"},it=t("label",{for:"title",class:"form-label"},"描述",-1),nt={class:"mb-3"},dt=t("label",{for:"title",class:"form-label"},"說明",-1),rt={class:"row mb-3"},ct={class:"col"},ut=t("label",{for:"category",class:"form-label"},"分類",-1),mt={class:"col"},pt=t("label",{for:"unit",class:"form-label"},"單位",-1),ht={class:"row mb-3"},gt={class:"col"},_t=t("label",{for:"origin-price",class:"form-label"},"原價",-1),ft={class:"col"},bt=t("label",{for:"price",class:"form-label"},"售價",-1),Pt={class:"row mb-3"},vt={class:"col"},$t=t("label",{class:"form-label"},"商品評價",-1),wt=["onClick"],yt={class:"material-symbols-outlined"},Ut={class:"col"},It={class:"form-check form-switch"},kt=t("label",{class:"form-check-label",for:"is-enabled"},"是否啟用",-1),Ct={class:"row mb-3"},Vt=t("label",{for:"image-url",class:"form-label"},"產品主圖",-1),At={class:"col"},Tt={class:"col input-group"},Et={class:"text-center"},Mt=["src"],Dt={class:"col"},Rt={class:"text-end mb-3"},Nt=t("hr",null,null,-1),Lt={class:"row mb-3"},St=["for"],Bt={class:"input-group"},Ft=["id","placeholder","onUpdate:modelValue"],Ht=["onClick"],zt={class:"text-start"},Ot=["src","alt"],jt={class:"modal-footer"},Xt=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1);function qt(e,s,l,c,h,a){return d(),r("div",K,[t("div",Q,[t("div",W,[t("div",Y,[t("h1",Z,m(`${e.isNew?"新增":"更新"}`)+"產品 ",1),x]),t("div",tt,[t("div",et,[t("div",st,[t("form",null,[t("div",ot,[at,u(t("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":s[0]||(s[0]=o=>e.selectedProduct.title=o)},null,512),[[p,e.selectedProduct.title]])]),t("div",lt,[it,u(t("textarea",{type:"text",class:"form-control",id:"content","onUpdate:modelValue":s[1]||(s[1]=o=>e.selectedProduct.content=o)},null,512),[[p,e.selectedProduct.content]])]),t("div",nt,[dt,u(t("textarea",{type:"text",class:"form-control",id:"description","onUpdate:modelValue":s[2]||(s[2]=o=>e.selectedProduct.description=o)},null,512),[[p,e.selectedProduct.description]])]),t("div",rt,[t("div",ct,[ut,u(t("input",{type:"text",class:"form-control",id:"category","onUpdate:modelValue":s[3]||(s[3]=o=>e.selectedProduct.category=o)},null,512),[[p,e.selectedProduct.category]])]),t("div",mt,[pt,u(t("input",{type:"text",class:"form-control",id:"unit","onUpdate:modelValue":s[4]||(s[4]=o=>e.selectedProduct.unit=o)},null,512),[[p,e.selectedProduct.unit]])])]),t("div",ht,[t("div",gt,[_t,u(t("input",{type:"number",class:"form-control",id:"origin-price","onUpdate:modelValue":s[5]||(s[5]=o=>e.selectedProduct.origin_price=o)},null,512),[[p,e.selectedProduct.origin_price,void 0,{number:!0}]])]),t("div",ft,[bt,u(t("input",{type:"number",class:"form-control",id:"price","onUpdate:modelValue":s[6]||(s[6]=o=>e.selectedProduct.price=o)},null,512),[[p,e.selectedProduct.price,void 0,{number:!0}]])])]),t("div",Pt,[t("div",vt,[$t,t("div",null,[(d(),r(b,null,w(5,o=>t("a",{href:"#",class:"text-decoration-none text-warning",onClick:$(i=>e.selectedProduct.rating=o,["prevent"]),key:o},[t("span",yt,m(o<=e.selectedProduct.rating?"stars":"star"),1)],8,wt)),64))])]),t("div",Ut,[t("div",It,[kt,u(t("input",{class:"form-check-input",type:"checkbox",id:"is-enabled",role:"switch","true-value":1,"false-value":0,"onUpdate:modelValue":s[7]||(s[7]=o=>e.selectedProduct.is_enabled=o)},null,512),[[E,e.selectedProduct.is_enabled]])])])]),t("div",Ct,[Vt,t("div",At,[u(t("input",{type:"text",class:"form-control",id:"image-url",placeholder:"請輸入主圖網址","onUpdate:modelValue":s[8]||(s[8]=o=>e.selectedProduct.imageUrl=o)},null,512),[[p,e.selectedProduct.imageUrl]])]),t("div",Tt,[t("input",{type:"file",class:"form-control",onChange:s[9]||(s[9]=(...o)=>a.uploadMainImage&&a.uploadMainImage(...o)),ref:"image-file"},null,544),t("button",{type:"button",class:"btn btn-outline-danger",onClick:s[10]||(s[10]=(...o)=>a.clearMainImageFile&&a.clearMainImageFile(...o))}," X ")]),t("div",Et,[e.selectedProduct.imageUrl.length>0?(d(),r("img",{key:0,class:"img-fluid w-50 mt-3",src:e.selectedProduct.imageUrl,alt:"產品主圖"},null,8,Mt)):I("",!0)])])])]),t("div",Dt,[t("div",Rt,[t("button",{type:"button",class:"btn btn-outline-primary me-3",onClick:s[11]||(s[11]=(...o)=>a.addImage&&a.addImage(...o))}," 新增圖片 "),t("button",{type:"button",class:"btn btn-outline-success",onClick:s[12]||(s[12]=(...o)=>a.uploadImageFile&&a.uploadImageFile(...o))}," 上傳圖片 ")]),Nt,t("form",null,[t("div",Lt,[(d(!0),r(b,null,w(e.selectedProduct.imagesUrl,(o,i)=>(d(),r("div",{class:"col-6",key:o.id},[t("label",{for:`image-url-${i+1}`,class:"form-label"},"圖片網址 "+m(i+1),9,St),t("div",Bt,[u(t("input",{type:"text",class:"form-control",id:`image-url-${i+1}`,placeholder:`請輸入圖片網址 ${i+1}`,"onUpdate:modelValue":n=>e.selectedProduct.imagesUrl[i]=n},null,8,Ft),[[p,e.selectedProduct.imagesUrl[i]]]),t("button",{type:"button",class:"btn btn-outline-danger",onClick:n=>a.removeImagesUrl(i)}," X ",8,Ht)]),t("div",zt,[e.selectedProduct.imagesUrl[i].length?(d(),r("img",{key:0,class:"img-fluid w-100 mt-3",src:e.selectedProduct.imagesUrl[i],alt:`產品圖片 ${i}`},null,8,Ot)):I("",!0)])]))),128))])])])])]),t("div",jt,[Xt,t("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal",onClick:s[13]||(s[13]=o=>a.updateProduct(e.isNew))},m(e.isNew?"新增":"更新"),1)])])])])}const Gt=U(J,[["render",qt]]),{VITE_API_URL:Jt,VITE_API_PATH:Kt}={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"frank-hex-api",BASE_URL:"/live-vue3-training-homework-week7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},Qt={name:"AdminProductsView",components:{Pagination:G,UpdateProductModal:Gt},data(){return{}},methods:{...M(g,["clearProduct","getProducts","selectProduct","setIsNew"]),showUpdateProductModal(e){this.selectProduct({...e}),this.setIsNew(!1)},async showDeleteProductModal(e){const{isConfirmed:s}=await this.$swal({title:`是否刪除 ${e.title}`,icon:"warning",showConfirmButton:!0,showCancelButton:!0,confirmButtonText:"確認",cancelButtonText:"取消"});if(s){const l=this.$loading.show();try{const{data:c}=await this.axios.delete(`${Jt}/api/${Kt}/admin/product/${e.id}`);c.success?(l.hide(),this.$swal({title:"刪除成功",icon:"success",showConfirmButton:!0}),await this.getProducts()):(l.hide(),this.$swal({title:"刪除失敗，請重新操作",icon:"error",showConfirmButton:!0}))}catch{l.hide(),this.$swal({title:"刪除失敗，請重新操作",icon:"error",showConfirmButton:!0})}}}},computed:{...y(g,["products","pagination","selectedProduct","isNew"])},async mounted(){const e=this.$loading.show();await this.getProducts(),e.hide()}},Wt=t("h1",null,"商品總覽",-1),Yt={class:"container mt-3"},Zt={class:"text-end"},xt={class:"table"},te=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"分類"),t("th",{scope:"col"},"產品名稱"),t("th",{scope:"col"},"原價"),t("th",{scope:"col"},"售價"),t("th",{scope:"col"},"是否啟用"),t("th",{scope:"col"},"編輯")])],-1),ee=["onClick"],se=["onClick"];function oe(e,s,l,c,h,a){const o=k("pagination"),i=k("update-product-modal");return d(),r(b,null,[Wt,t("div",Yt,[t("div",Zt,[t("button",{class:"btn btn-primary","data-bs-toggle":"modal","data-bs-target":"#updateProductModal",onClick:s[0]||(s[0]=n=>{e.setIsNew(!0),e.clearProduct()})}," 建立新產品 ")]),t("table",xt,[te,t("tbody",null,[(d(!0),r(b,null,w(e.products,n=>(d(),r("tr",{key:n.id},[t("th",null,m(n.category),1),t("td",null,m(n.title),1),t("td",null,m(n.origin_price),1),t("td",null,m(n.price),1),t("td",{class:V(n.is_enabled?"text-success":"")},m(n.is_enabled?"已啟用":"未啟用"),3),t("td",null,[t("button",{class:"btn btn-sm btn-outline-primary me-3","data-bs-toggle":"modal","data-bs-target":"#updateProductModal",onClick:A=>a.showUpdateProductModal(n)}," 編輯 ",8,ee),t("button",{class:"btn btn-sm btn-outline-danger","data-bs-toggle":"modal","data-bs-target":"#deleteProductModal",onClick:A=>a.showDeleteProductModal(n)}," 刪除 ",8,se)])]))),128))])]),C(o)]),C(i,{ref:"update-product-modal"},null,512)],64)}const le=U(Qt,[["render",oe]]);export{le as default};
