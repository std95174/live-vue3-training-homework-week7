import{_ as w,e as m,g as b,o as a,c as i,a as t,f as $,F as v,h as k,n as P,t as o,p as _,r as O,b as C}from"./index-d187ca93.js";const{VITE_API_URL:A,VITE_API_PATH:T}={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"frank-hex-api",BASE_URL:"/live-vue3-training-homework-week7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},I={name:"OrderPagination",data(){return{pagination:{}}},methods:{async pageChange(e){(e!==this.pagination.current_page||e>=0||e<=this.pagination.total_pages)&&await this.getOrders(e)},async getOrders(e=1){const{data:n}=await m.get(`${A}/api/${T}/admin/orders?page=${e}`,{headers:{Authorization:`${b()}`}});this.$emit("page-changed",n.orders),this.pagination=n.pagination}},async mounted(){await this.getOrders()}},x={"aria-label":"Page navigation"},E={class:"pagination justify-content-center"},V={class:"page-item"},B=t("span",{"aria-hidden":"true"},"«",-1),M=[B],R=["onClick"],L={class:"page-item"},S=t("span",{"aria-hidden":"true"},"»",-1),D=[S];function U(e,n,s,h,l,c){return a(),i("nav",x,[t("ul",E,[t("li",V,[t("a",{class:"page-link",href:"#",onClick:n[0]||(n[0]=$(d=>c.pageChange(l.pagination.current_page-1),["prevent"]))},M)]),(a(!0),i(v,null,k(l.pagination.total_pages,d=>(a(),i("li",{class:P(["page-item",{active:l.pagination.current_page===d}]),key:d},[t("a",{class:"page-link",href:"#",onClick:$(g=>c.pageChange(d),["prevent"])},o(d),9,R)],2))),128)),t("li",L,[t("a",{class:"page-link",href:"#",onClick:n[1]||(n[1]=$(d=>c.pageChange(l.pagination.current_page+1),["prevent"]))},D)])])])}const z=w(I,[["render",U]]),H={name:"OrderModal",data(){return{modal:{}}},props:{order:{type:Object,required:!0}}},q={class:"modal fade",id:"orderModal",tabindex:"-1","aria-labelledby":"updateOrderModalLabel","aria-hidden":"true"},N={class:"modal-dialog modal-xl"},j={class:"modal-content"},F=t("div",{class:"modal-header"},[t("h1",{class:"modal-title fs-5",id:"updateOrderModalLabel"}," 訂單詳細資訊 "),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),G={class:"modal-body"},J={class:"row"},K={class:"card"},Q=t("div",{class:"card-header"},[t("h5",{class:"card-title"},"訂單詳細內容")],-1),W={class:"card-body"},X={class:"row mb-3"},Y={class:"col-md-4"},Z=t("strong",null,"訂單編號：",-1),tt={class:"col-md-4"},et=t("strong",null,"訂單日期：",-1),st={class:"col-md-4"},ot=t("strong",null,"訂單狀態：",-1),nt={class:"row mb-3"},at={class:"col-md-4"},it=t("strong",null,"客戶姓名：",-1),dt={class:"col-md-4"},rt=t("strong",null,"客戶電話：",-1),lt={class:"col-md-4"},ct=t("strong",null,"客戶地址：",-1),_t={class:"row mb-3"},ht={class:"col-md-4"},ut=t("strong",null,"客戶信箱：",-1),gt={class:"col-md-8"},pt=t("strong",null,"留言：",-1),mt={class:"table table-striped"},bt=t("thead",null,[t("tr",null,[t("th",null,"產品名稱"),t("th",null,"數量"),t("th",null,"單價"),t("th",null,"小計")])],-1),vt=t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消")],-1);function $t(e,n,s,h,l,c){var d,g,r,p;return a(),i("div",q,[t("div",N,[t("div",j,[F,t("div",G,[t("div",J,[t("div",K,[Q,t("div",W,[t("div",X,[t("div",Y,[Z,_(" "+o(s.order.id),1)]),t("div",tt,[et,_(" "+o(s.order.create_at),1)]),t("div",st,[ot,_(" "+o(s.order.is_paid?"已付款":"未付款"),1)])]),t("div",nt,[t("div",at,[it,_(" "+o((d=s.order.user)==null?void 0:d.name),1)]),t("div",dt,[rt,_(" "+o((g=s.order.user)==null?void 0:g.tel),1)]),t("div",lt,[ct,_(" "+o((r=s.order.user)==null?void 0:r.address),1)])]),t("div",_t,[t("div",ht,[ut,_(" "+o((p=s.order.user)==null?void 0:p.email),1)]),t("div",gt,[pt,_(" "+o(s.order.message),1)])]),t("table",mt,[bt,t("tbody",null,[(a(!0),i(v,null,k(s.order.products,u=>(a(),i("tr",{key:u.id},[t("td",null,o(u.product_id),1),t("td",null,o(u.qty),1),t("td",null,o(u.price),1),t("td",null,o(u.price*u.qty),1)]))),128))])])])])])]),vt])])])}const ft=w(H,[["render",$t]]),{VITE_API_URL:f,VITE_API_PATH:y}={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"frank-hex-api",BASE_URL:"/live-vue3-training-homework-week7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},yt={name:"OrdersView",data(){return{orders:[],selectedOrder:{}}},components:{OrderModal:ft,OrderPagination:z},methods:{async deleteOrder(e){const{isConfirmed:n}=await this.$swal({title:"是否刪除此訂單？",icon:"warning",showConfirmButton:!0,showCancelButton:!0,confirmButtonText:"確認",cancelButtonText:"取消"});if(n){const s=this.$loading.show(),{data:h}=await m.delete(`${f}/api/${y}/admin/order/${e.id}`,{headers:{Authorization:`${b()}`}});h.success&&(s.hide(),this.$swal({title:"已調整付款狀態",icon:"success"}),await this.getOrders())}},async payOrder(e){const{isConfirmed:n}=await this.$swal({title:"是否調整付款狀態？",icon:"warning",showConfirmButton:!0,showCancelButton:!0,confirmButtonText:"確認",cancelButtonText:"取消"});if(n){const s=this.$loading.show(),{data:h}=await m.post(`${f}/api/${y}/pay/${e.id}`,{headers:{Authorization:`${b()}`}});h.success&&(s.hide(),this.$swal({title:"付款成功",icon:"success"}),await this.getOrders())}},async getOrders(){const{data:e}=await m.get(`${f}/api/${y}/admin/orders`,{headers:{Authorization:`${b()}`}});this.orders=e.orders},setOrders(e){this.orders=e},formatMoney(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}},computed:{},async mounted(){await this.getOrders()}},wt=t("h1",null,"這是訂單頁面",-1),kt={class:"table"},Ot=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"消費者"),t("th",{scope:"col"},"付款狀態"),t("th",{scope:"col"},"手動調整付款"),t("th",{scope:"col"},"總價"),t("th",{scope:"col"})])],-1),Ct={key:0,class:"badge rounded-pill bg-success ms-2"},Pt={key:1,class:"badge rounded-pill bg-danger ms-2"},At=["onClick"],Tt={key:1},It=["onClick"],xt=["onClick"];function Et(e,n,s,h,l,c){const d=O("order-pagination"),g=O("order-modal");return a(),i(v,null,[wt,t("table",kt,[Ot,t("tbody",null,[(a(!0),i(v,null,k(l.orders,r=>(a(),i("tr",{key:r.id},[t("th",null,o(r.user.name),1),t("td",null,[r.is_paid?(a(),i("span",Ct,"已付款")):(a(),i("span",Pt,"尚未付款"))]),t("td",null,[r.is_paid?(a(),i("span",Tt,"-")):(a(),i("button",{key:0,type:"button",class:"btn btn-outline-primary",onClick:p=>c.payOrder(r)},"付款 ",8,At))]),t("td",null,o(c.formatMoney(r.total))+" 元 ",1),t("td",null,[t("button",{type:"button",class:"btn btn-outline-primary","data-bs-toggle":"modal","data-bs-target":"#orderModal",onClick:p=>l.selectedOrder=r},"詳細資料",8,It),t("button",{type:"button",class:"btn btn-outline-danger",onClick:p=>c.deleteOrder(r)},"刪除",8,xt)])]))),128))])]),C(d,{onPageChanged:c.setOrders},null,8,["onPageChanged"]),C(g,{order:l.selectedOrder},null,8,["order"])],64)}const Bt=w(yt,[["render",Et]]);export{Bt as default};
